<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>@xjump</title>


  <script type="text/javascript" src="/slideout/1.0.1/slideout.min.js"></script>

  <link rel="stylesheet" href="/katex/0.10.1/katex.min.css">
  <script type="text/javascript" defer src="/katex/0.10.1/katex.min.js" ></script>
  <script type="text/javascript" defer src="/katex/0.10.1/contrib/mathtex-script-type.min.js" ></script>

  <script type="text/javascript" defer src="/katex/0.10.1/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>




  <link rel="stylesheet" href="/site.css">

  <link rel="stylesheet" href="/katex/0.10.1/katex.min.css"  >





</head>

<body>
  <div class="container">
    <div id="mobile-navbar" class="mobile-navbar">
      <div class="mobile-header-logo">
      <a href="/" class="logo">@xjump</a>
      </div>
      <div class="mobile-navbar-icon icon-out">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
      <ul class="mobile-menu-list">
      
        <li class="mobile-menu-item">
        <a href="https:&#x2F;&#x2F;xjump.me">Home</a>
        </li>
      
        <li class="mobile-menu-item">
        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;categories">Categories</a>
        </li>
      
        <li class="mobile-menu-item">
        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;tags&#x2F;all">Archive</a>
        </li>
      
        <li class="mobile-menu-item">
        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;rss.xml">RSS</a>
        </li>
      
        <li class="mobile-menu-item">
        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;about">About</a>
        </li>
      
      </ul>
    </nav>

    <header id="header">
      <div class="logo"><a href="https:&#x2F;&#x2F;xjump.me">@xjump</a></div>
      <nav class="menu">
        <ul>
        
    <li><a href="https:&#x2F;&#x2F;xjump.me">Home </a></li>
        
    <li><a href="https:&#x2F;&#x2F;xjump.me&#x2F;categories">Categories </a></li>
        
    <li><a href="https:&#x2F;&#x2F;xjump.me&#x2F;tags&#x2F;all">Archive </a></li>
        
    <li><a href="https:&#x2F;&#x2F;xjump.me&#x2F;rss.xml">RSS </a></li>
        
    <li><a href="https:&#x2F;&#x2F;xjump.me&#x2F;about">About </a></li>
        
        </ul>
      </nav>
    </header>

    <main>
      <div class="content" id="mobile-panel">




<article class="post">

<header class="post__header">
  <h1 class="post__title"><a href="https:&#x2F;&#x2F;xjump.me&#x2F;android-dex-dynamic-load-call-and-security&#x2F;">Android Dex动态加载、调用与安全</a></h1>
  <div class="post__meta">
    <span class="post__time">2018-10-13</span>

  </div>
</header>

 <div class="post-content"><p>首先，动态加载与调用不是个新问题，方法也非常直接。关键就是使用DexClassLoader。</p>
<p>这个方法有一个副作用，那就是/proc/self/maps下会留下很多份dex加载记录，需要到jvm GC时才能释放，内存泄漏倒是没有，就是不太好看。</p>
<p>对于入参不是String，返回结果不是String的情况，做个Ser/De来搞定即可，接口的界面也能保持干净。</p>
<span id="continue-reading"></span>
<p>注意，如果要保证Dex文件的安全，这个方法是不行的。关键点在DexClassLoader的构造函数第二个参数cachedDir，所有的简单加壳都会走到这里，解密脱壳后的Dex文件写到这个cachedDir目录下。所以有些简单的脱壳机在这里hook就能解决战斗了。</p>
<p>复杂的加壳/脱壳的对抗需要去寻找jvm加载Dex的更底层的api了，比如<a href="https://bbs.ichunqiu.com/thread-12734-1-1.html?from=paper/">这里</a>介绍的这些api： </p>
<pre style="background-color:#212121;">
<code class="language-c++" data-lang="c++"><span style="color:#c792ea;">const</span><span style="color:#eeffff;"> DalvikNativeMethod dvm_dalvik_system_DexFile</span><span style="color:#89ddff;">[] = { </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ &quot;</span><span style="color:#c3e88d;">openDexFile</span><span style="color:#89ddff;">&quot;, &quot;</span><span style="color:#c3e88d;">(Ljava/lang/String;Ljava/lang/String;I)I</span><span style="color:#89ddff;">&quot;, </span><span style="color:#eeffff;">
  Dalvik_dalvik_system_DexFile_openDexFile </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ &quot;</span><span style="color:#c3e88d;">openDexFile</span><span style="color:#89ddff;">&quot;, &quot;</span><span style="color:#c3e88d;">([B)I</span><span style="color:#89ddff;">&quot;, </span><span style="color:#eeffff;">
  Dalvik_dalvik_system_DexFile_openDexFile_bytearray </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ &quot;</span><span style="color:#c3e88d;">closeDexFile</span><span style="color:#89ddff;">&quot;, &quot;</span><span style="color:#c3e88d;">(I)V</span><span style="color:#89ddff;">&quot;, </span><span style="color:#eeffff;">
  Dalvik_dalvik_system_DexFile_closeDexFile </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ &quot;</span><span style="color:#c3e88d;">defineClass</span><span style="color:#89ddff;">&quot;, &quot;</span><span style="color:#c3e88d;">(Ljava/lang/String;Ljava/lang/ClassLoader;I)Ljava/lang/Class;</span><span style="color:#89ddff;">&quot;, </span><span style="color:#eeffff;">
  Dalvik_dalvik_system_DexFile_defineClass </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ &quot;</span><span style="color:#c3e88d;">getClassNameList</span><span style="color:#89ddff;">&quot;, &quot;</span><span style="color:#c3e88d;">(I)[Ljava/lang/String;</span><span style="color:#89ddff;">&quot;, </span><span style="color:#eeffff;">
  Dalvik_dalvik_system_DexFile_getClassNameList </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ &quot;</span><span style="color:#c3e88d;">isDexOptNeeded</span><span style="color:#89ddff;">&quot;, &quot;</span><span style="color:#c3e88d;">(Ljava/lang/String;)Z</span><span style="color:#89ddff;">&quot;, </span><span style="color:#eeffff;">
  Dalvik_dalvik_system_DexFile_isDexOptNeeded </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">{ </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">}, </span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">};</span><span style="color:#eeffff;">
</span></code></pre>
<p>当然，Dex加壳/脱壳的对抗并没有止于此，寻找更底层的api，或者更本质的讲，寻找更底层的代码片段来Hook/Call就是更进一步的对抗方向了。但结论是明显的，无论如何，逆向工程最终会胜利。</p>
<p>附，加载过程示例代码（Java）如下：</p>
<pre style="background-color:#212121;">
<code class="language-java" data-lang="java"><span style="color:#eeffff;">btnLoadDexAndCall</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">setOnClickListener</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">new </span><span style="color:#ffcb6b;">View</span><span style="color:#89ddff;">.</span><span style="color:#ffcb6b;">OnClickListener</span><span style="color:#89ddff;">() {</span><span style="color:#82aaff;">
  </span><span style="color:#89ddff;">@</span><span style="color:#eeffff;">Override</span><span style="color:#82aaff;">
  </span><span style="color:#c792ea;">public </span><span style="font-style:italic;color:#c792ea;">void </span><span style="color:#82aaff;">onClick</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">View </span><span style="color:#f78c6c;">view</span><span style="color:#89ddff;">) {</span><span style="color:#82aaff;">
    </span><span style="color:#ffcb6b;">Class</span><span style="color:#82aaff;"> libProviderClazz </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">null</span><span style="color:#89ddff;">;</span><span style="color:#82aaff;">
    </span><span style="font-style:italic;color:#c792ea;">try </span><span style="color:#89ddff;">{</span><span style="color:#82aaff;">
      libProviderClazz </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">Class</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">forName</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">me.xjump.utils.Test</span><span style="color:#89ddff;">&quot;);</span><span style="color:#82aaff;">
    </span><span style="color:#89ddff;">}</span><span style="font-style:italic;color:#c792ea;">catch</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">ClassNotFoundException </span><span style="color:#f78c6c;">ex</span><span style="color:#89ddff;">) {   </span><span style="font-style:italic;color:#4a4a4a;">// 每次都会到这里。不是Dex，而是jar包的情况可以自己探索一下。</span><span style="font-style:italic;color:#4a4a4a;">
      </span><span style="color:#ffcb6b;">Log</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">e</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">TAG</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> ex</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">toString</span><span style="color:#89ddff;">());</span><span style="color:#82aaff;">
      </span><span style="font-style:italic;color:#c792ea;">try </span><span style="color:#89ddff;">{</span><span style="color:#82aaff;">
        </span><span style="color:#c792ea;">final </span><span style="color:#ffcb6b;">File</span><span style="color:#82aaff;"> dexPath </span><span style="color:#89ddff;">= </span><span style="color:#c792ea;">new </span><span style="color:#ffcb6b;">File</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">/data/local/tmp/classes1.dex</span><span style="color:#89ddff;">&quot;);</span><span style="color:#82aaff;">
        </span><span style="color:#ffcb6b;">Log</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">d</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">TAG</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> dexPath</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">getAbsolutePath</span><span style="color:#89ddff;">());</span><span style="color:#82aaff;">
        </span><span style="color:#ffcb6b;">ClassLoader</span><span style="color:#82aaff;"> loader </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">ClassLoader</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">getSystemClassLoader</span><span style="color:#89ddff;">();</span><span style="color:#82aaff;">
        </span><span style="color:#ffcb6b;">DexClassLoader</span><span style="color:#82aaff;"> cl </span><span style="color:#89ddff;">= </span><span style="color:#c792ea;">new </span><span style="color:#ffcb6b;">DexClassLoader</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">dexPath</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">getAbsolutePath</span><span style="color:#89ddff;">(),</span><span style="color:#82aaff;">
            ctx</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">getFilesDir</span><span style="color:#89ddff;">().</span><span style="color:#82aaff;">toString</span><span style="color:#89ddff;">(), </span><span style="color:#f78c6c;">null</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> loader</span><span style="color:#89ddff;">);</span><span style="color:#82aaff;">
        libProviderClazz </span><span style="color:#89ddff;">=</span><span style="color:#82aaff;"> cl</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">loadClass</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">me.xjump.utils.Test</span><span style="color:#89ddff;">&quot;);</span><span style="color:#82aaff;">
        </span><span style="color:#ffcb6b;">Method</span><span style="color:#82aaff;"> method </span><span style="color:#89ddff;">=</span><span style="color:#82aaff;"> libProviderClazz</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">getMethod</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">testme</span><span style="color:#89ddff;">&quot;, </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">.</span><span style="font-style:italic;color:#ff5370;">class</span><span style="color:#89ddff;">);</span><span style="color:#82aaff;">
        </span><span style="color:#ffcb6b;">Log</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">w</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">TAG</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> method</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">invoke</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">null</span><span style="color:#89ddff;">, &quot;</span><span style="color:#c3e88d;">message</span><span style="color:#89ddff;">&quot;).</span><span style="color:#82aaff;">toString</span><span style="color:#89ddff;">());</span><span style="color:#82aaff;">
</span><span style="color:#82aaff;">
      </span><span style="color:#89ddff;">} </span><span style="font-style:italic;color:#c792ea;">catch </span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">Exception </span><span style="color:#f78c6c;">exception</span><span style="color:#89ddff;">) {</span><span style="color:#82aaff;">
        </span><span style="color:#ffcb6b;">Log</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">e</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">TAG</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> exception</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">toString</span><span style="color:#89ddff;">());</span><span style="color:#82aaff;">
        exception</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">printStackTrace</span><span style="color:#89ddff;">();</span><span style="color:#82aaff;">
      </span><span style="color:#89ddff;">}</span><span style="color:#82aaff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#82aaff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#82aaff;">
</span><span style="color:#89ddff;">});</span><span style="color:#eeffff;">
</span></code></pre>
<p>翻译成C++/jni的代码如下：</p>
<pre style="background-color:#212121;">
<code class="language-c++" data-lang="c++"><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string </span><span style="color:#82aaff;">callDexStaticMethod</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">const</span><span style="color:#eeffff;"> std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string </span><span style="color:#89ddff;">&amp;</span><span style="color:#f78c6c;">dexFile</span><span style="color:#89ddff;">, </span><span style="color:#c792ea;">const</span><span style="color:#eeffff;"> std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string </span><span style="color:#89ddff;">&amp;</span><span style="color:#f78c6c;">dexCacheDir</span><span style="color:#89ddff;">, </span><span style="color:#c792ea;">const</span><span style="color:#eeffff;"> std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string </span><span style="color:#89ddff;">&amp;</span><span style="color:#f78c6c;">clz</span><span style="color:#89ddff;">, </span><span style="color:#c792ea;">const</span><span style="color:#eeffff;"> std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string </span><span style="color:#89ddff;">&amp;</span><span style="color:#f78c6c;">staticMethod</span><span style="color:#89ddff;">, </span><span style="color:#c792ea;">const</span><span style="color:#eeffff;"> std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string</span><span style="color:#89ddff;">&amp; </span><span style="color:#f78c6c;">args</span><span style="color:#89ddff;">) </span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">{</span><span style="color:#eeffff;">
  std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string ret </span><span style="color:#89ddff;">= &quot;&quot;;</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">int</span><span style="color:#eeffff;"> status </span><span style="color:#89ddff;">= -</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">string className </span><span style="color:#89ddff;">= &quot;&quot;;</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  JNIEnv </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jstring jDexPath </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jstring jDestDexPath </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jstring jClz </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jstring jArgs </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  jclass classloaderClass </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jmethodID getSysLoaderMethod </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jobject sysLoader </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jclass dexLoaderClass </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jmethodID initDexLoaderMethod </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jobject dexLoader </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jmethodID loadClassMethod </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jclass javaClientClass </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jmethodID javaClientStaticFuncMethod </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
  jstring result </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">do </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">g_JVM </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">nullptr</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] g_JVM is null.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    status </span><span style="color:#89ddff;">= ((</span><span style="color:#eeffff;">JavaVM </span><span style="color:#89ddff;">*)</span><span style="color:#eeffff;"> g_JVM</span><span style="color:#89ddff;">)-&gt;</span><span style="color:#82aaff;">AttachCurrentThread</span><span style="color:#89ddff;">(&amp;</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">status </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">||</span><span style="color:#eeffff;"> env </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] init: failed to attach current thread </span><span style="color:#eeffff;">%d</span><span style="color:#89ddff;">&quot;,</span><span style="color:#82aaff;"> status</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    </span><span style="color:#82aaff;">LOGI</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[*] dex=</span><span style="color:#eeffff;">%s</span><span style="color:#c3e88d;">,dexDest=</span><span style="color:#eeffff;">%s</span><span style="color:#c3e88d;">,clz=</span><span style="color:#eeffff;">%s</span><span style="color:#c3e88d;">,method=</span><span style="color:#eeffff;">%s</span><span style="color:#89ddff;">&quot;,</span><span style="color:#82aaff;"> dexFile</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">(),</span><span style="color:#82aaff;"> dexCacheDir</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">(),</span><span style="color:#82aaff;">
       clz</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">(),</span><span style="color:#82aaff;"> staticMethod</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    jDexPath </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">CppUtils</span><span style="color:#89ddff;">::</span><span style="color:#82aaff;">stdString2jstring</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">env</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> dexFile</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
    jDestDexPath </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">CppUtils</span><span style="color:#89ddff;">::</span><span style="color:#82aaff;">stdString2jstring</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">env</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> dexCacheDir</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
    jClz </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">CppUtils</span><span style="color:#89ddff;">::</span><span style="color:#82aaff;">stdString2jstring</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">env</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> clz</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
    jArgs </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">CppUtils</span><span style="color:#89ddff;">::</span><span style="color:#82aaff;">stdString2jstring</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">env</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> args</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">jDexPath</span><span style="color:#89ddff;">==</span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">||</span><span style="color:#eeffff;"> jDestDexPath</span><span style="color:#89ddff;">==</span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">||</span><span style="color:#eeffff;"> jClz</span><span style="color:#89ddff;">==</span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">||</span><span style="color:#eeffff;">jArgs</span><span style="color:#89ddff;">==</span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] jDexPath/jDestDexPath/jClz/jArgs is null.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    className </span><span style="color:#89ddff;">= &quot;</span><span style="color:#c3e88d;">java/lang/ClassLoader</span><span style="color:#89ddff;">&quot;;</span><span style="color:#eeffff;">
    classloaderClass </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">FindClass</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">className</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] find </span><span style="color:#eeffff;">%s</span><span style="color:#c3e88d;"> cls exception.</span><span style="color:#89ddff;">&quot;,</span><span style="color:#82aaff;"> className</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">classloaderClass </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] class(</span><span style="color:#eeffff;">%s</span><span style="color:#c3e88d;">) not find.</span><span style="color:#89ddff;">&quot;,</span><span style="color:#82aaff;"> className</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    getSysLoaderMethod </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">GetStaticMethodID</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">classloaderClass</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;">
                          </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">getSystemClassLoader</span><span style="color:#89ddff;">&quot;,</span><span style="color:#eeffff;">
                          </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">()Ljava/lang/ClassLoader;</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] getSysLoaderMethod exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">getSysLoaderMethod </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] getSysLoaderMethod not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    sysLoader </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">CallStaticObjectMethod</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">classloaderClass</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> getSysLoaderMethod</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] sysLoader exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">sysLoader </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] sysLoader not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    dexLoaderClass </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">FindClass</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">dalvik/system/DexClassLoader</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] dexLoaderClass exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoaderClass </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] dexLoaderClass not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    initDexLoaderMethod </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">GetMethodID</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoaderClass</span><span style="color:#89ddff;">, &quot;</span><span style="color:#c3e88d;">&lt;init&gt;</span><span style="color:#89ddff;">&quot;,</span><span style="color:#eeffff;">
                         </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">(Ljava/lang/String;Ljava/lang/String;</span><span style="color:#89ddff;">&quot;</span><span style="color:#eeffff;">
                         </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">Ljava/lang/String;Ljava/lang/ClassLoader;)V</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] initDexLoaderMethod exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">initDexLoaderMethod </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] initDexLoaderMethod not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    dexLoader </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">NewObject</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoaderClass</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> initDexLoaderMethod</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;">
                   jDexPath</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> jDestDexPath</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> sysLoader</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] dexLoader exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoader </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] dexLoader not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    loadClassMethod </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">GetMethodID</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">classloaderClass</span><span style="color:#89ddff;">, &quot;</span><span style="color:#c3e88d;">loadClass</span><span style="color:#89ddff;">&quot;,</span><span style="color:#eeffff;">
                       </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">(Ljava/lang/String;)Ljava/lang/Class;</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] loadClassMethod exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#4a4a4a;">//env-&gt;ExceptionDescribe();</span><span style="font-style:italic;color:#4a4a4a;">
</span><span style="color:#eeffff;">      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">loadClassMethod </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] loadClassMethod not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    javaClientClass </span><span style="color:#89ddff;">= (</span><span style="color:#eeffff;">jclass</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">CallObjectMethod</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoader</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> loadClassMethod</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> jClz</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] javaClientClass exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionDescribe</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">javaClientClass </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] javaClientClass not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    javaClientStaticFuncMethod </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">GetStaticMethodID</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">javaClientClass</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;">
                              staticMethod</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">(),</span><span style="color:#eeffff;">
                              </span><span style="color:#89ddff;">&quot;</span><span style="color:#c3e88d;">(Ljava/lang/String;)Ljava/lang/String;</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] javaClientStaticFuncMethod exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionDescribe</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">javaClientStaticFuncMethod </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] javaClientStaticFuncMethod not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    result </span><span style="color:#89ddff;">= (</span><span style="color:#eeffff;">jstring</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;"> env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">CallStaticObjectMethod</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">javaClientClass</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;">
        javaClientStaticFuncMethod</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> jArgs</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionCheck</span><span style="color:#89ddff;">()) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] result exception.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionDescribe</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">ExceptionClear</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">result </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
      </span><span style="color:#82aaff;">LOGE</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[-] result not find.</span><span style="color:#89ddff;">&quot;);</span><span style="color:#eeffff;">
      </span><span style="font-style:italic;color:#c792ea;">break</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
    </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
    ret </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">CppUtils</span><span style="color:#89ddff;">::</span><span style="color:#82aaff;">jstring2StdString</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">env</span><span style="color:#89ddff;">,</span><span style="color:#82aaff;"> result</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
    </span><span style="color:#82aaff;">LOGD</span><span style="color:#89ddff;">(&quot;</span><span style="color:#c3e88d;">[+] call ok, ret=</span><span style="color:#eeffff;">%s</span><span style="color:#89ddff;">&quot;,</span><span style="color:#82aaff;"> ret</span><span style="color:#89ddff;">.</span><span style="color:#82aaff;">c_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">} </span><span style="font-style:italic;color:#c792ea;">while </span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> result </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">result</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#4a4a4a;">/*</span><span style="font-style:italic;color:#4a4a4a;">
   if(env!=NULL &amp;&amp; javaClientStaticFuncMethod!=NULL) {</span><span style="font-style:italic;color:#4a4a4a;">
     env-&gt;DeleteLocalRef(javaClientStaticFuncMethod);</span><span style="font-style:italic;color:#4a4a4a;">
   }</span><span style="font-style:italic;color:#4a4a4a;">
  */</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> javaClientClass </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">javaClientClass</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#4a4a4a;">/*</span><span style="font-style:italic;color:#4a4a4a;">
    if(env!=NULL &amp;&amp; loadClassMethod!=NULL) {</span><span style="font-style:italic;color:#4a4a4a;">
      env-&gt;DeleteLocalRef(loadClassMethod);</span><span style="font-style:italic;color:#4a4a4a;">
    }</span><span style="font-style:italic;color:#4a4a4a;">
    */</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> dexLoader </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoader</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#4a4a4a;">/*</span><span style="font-style:italic;color:#4a4a4a;">
  if(env!=NULL &amp;&amp; initDexLoaderMethod!=NULL) {</span><span style="font-style:italic;color:#4a4a4a;">
    env-&gt;DeleteLocalRef(initDexLoaderMethod);</span><span style="font-style:italic;color:#4a4a4a;">
  }</span><span style="font-style:italic;color:#4a4a4a;">
  */</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> dexLoaderClass </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">dexLoaderClass</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> sysLoader </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">sysLoader</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#4a4a4a;">/*</span><span style="font-style:italic;color:#4a4a4a;">
  if(env!=NULL &amp;&amp; getSysLoaderMethod!=NULL) {</span><span style="font-style:italic;color:#4a4a4a;">
    env-&gt;DeleteLocalRef(getSysLoaderMethod);</span><span style="font-style:italic;color:#4a4a4a;">
  }</span><span style="font-style:italic;color:#4a4a4a;">
  */</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> classloaderClass </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">classloaderClass</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> jDexPath </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">jDexPath</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> jDestDexPath </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">jDestDexPath</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> jClz </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">jClz</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> jArgs </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    env</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DeleteLocalRef</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">jArgs</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">env </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">NULL </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> status </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">&amp;&amp;</span><span style="color:#eeffff;"> g_JVM </span><span style="color:#89ddff;">!= </span><span style="color:#f78c6c;">nullptr</span><span style="color:#89ddff;">) {</span><span style="color:#eeffff;">
    g_JVM</span><span style="color:#89ddff;">-&gt;</span><span style="color:#82aaff;">DetachCurrentThread</span><span style="color:#89ddff;">();</span><span style="color:#eeffff;">
  </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
  </span><span style="font-style:italic;color:#c792ea;">return</span><span style="color:#eeffff;"> ret</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">
</span></code></pre></div>


  <div class="post-footer">

  
    <div class="post-tags">
    
      <!-- <a href="https:&#x2F;&#x2F;xjump.me&#x2F;tags&#x2F;all&#x2F;">#all</a> -->
    
    </div>
  
  
    <div class="post-nav">
    
      <a class="previous" href="https:&#x2F;&#x2F;xjump.me&#x2F;java-dyn-script&#x2F;">‹ Java动态脚本</a>
    
    
      <a class="next" href="https:&#x2F;&#x2F;xjump.me&#x2F;20190701-flink-intro1&#x2F;">Flink应用(1) ›</a>
    
    
    
    </div>
  

  </div>


</article>

      </div>
    </main>



  </div>


<script type="text/javascript" src="/even.js"></script>

</body></html>
